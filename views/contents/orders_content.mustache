<style>
blockquote{
 font-size: 12px; 
 color: red;  
}
.offcanvas {
    height: 100%;
    width: 0;
    position: fixed;
    z-index: 1000; /* Mengatur nilai z-index yang lebih tinggi */
    top: 0;
    right: 0;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    overflow-x: hidden;
    transition: 0.5s;
    padding-top: 60px;
}

.offcanvas .body-offcanvas {
    padding: 0px 32px;
    text-decoration: none;
    color: #818181;
    display: block;
    transition: 0.3s;
}

.offcanvas a:hover {
    color: #f1f1f1;
}

.offcanvas .closebtn {
    position: absolute;
    top: 0;
    padding: 8px 32px;
    font-size: 24px;
    margin-right: 50px;
}
</style>
<script>
    function openOffcanvas() {
        document.getElementById("myOffcanvas").style.width = "350px";
        document.getElementById("main").style.marginRight = "350px";
    }

    function closeOffcanvas() {
        document.getElementById("myOffcanvas").style.width = "0";
        document.getElementById("main").style.marginRight = "0";
    }
</script>
<div id="myOffcanvas" class="offcanvas">
    <a href="javascript:void(0)" class="closebtn" onclick="closeOffcanvas()">Ã—</a>
    <div class="body-offcanvas">
        <h5>Product Detail</h5>
        <table class="table table-sm table-bordered table-striped" width="100%" cellspacing="0">
            <tbody>
                <tr>
                    <td>Name</td>
                    <td>AMD Ryzen 3200G</td>
                </tr>
                <tr>
                    <td>Price</td>
                    <td>IDR 1.900.000</td>
                </tr>
            </tbody>
        </table>
        <blockquote>
            *this is the current price, if the purchase calculation is different, then its
            <cite> <b>the old price</b></cite>.
        </blockquote>
        <h5>Order Detail</h5>
        <table class="table table-sm table-bordered table-striped" width="100%" cellspacing="0">
            <tbody>
                <tr>
                    <td>Buyer</td>
                    <td>Anto Selang</td>
                </tr>
                <tr>
                    <td>No. Phone</td>
                    <td>082283772387</td>
                </tr>
                <tr>
                    <td>Address</td>
                    <td>Jl. Kenangan No. 02</td>
                </tr>
                <tr>
                    <td>Status</td>
                    <td><h6 class="badge badge-info">On Delivery</h6></td>
                </tr>
            </tbody>
        </table>
        <h5>Payment</h5>
        <div>Quantity = 2</div>
        <div>Total = 3.800.000</div>
        <br>
        <button type="button" class="btn btn-success">Finish</button>
        <button type="button" class="btn btn-secondary">Others</button>
    </div>
    <!-- Tambahkan detail sesuai kebutuhan -->
</div>
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Orders</h1>
        <div id="add-stocks-button"><a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i>New Order</i></a></div>
        <div id="return-button" hidden><a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i>Return</i></a></div>
    </div>
    <!-- DataTales Example -->
    <div class="card shadow mb-4" id="card-products">
        <div class="card">
            <div class="card-header py-3">
                <ul class="nav nav-tabs" style="border-bottom: none;">
                    <li class="nav-item">
                        <a class="nav-link active" id="ongoing-tab" data-toggle="tab" href="#on-going-button" style="background: none; border: none;">On Going</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="finished-tab" data-toggle="tab" href="#finished-button" style="background: none; border: none;">Finished</a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="on-going-button">
                        <!-- On Going Content -->
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-striped" id="orderGoingTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Total Order</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#orders}}
                                    <tr>
                                        <td>{{productId}}</td>
                                        <td>{{pieces}}</td>
                                        <td>3.900.000</td>
                                        <td><h6 class="badge badge-info">{{statusId}}</h6></td>
                                        <td class="text-center">
                                            <div class="dropdown">
                                                <!-- editEmployeeModal -->
                                                <!-- <a href="javascript:void(0);" data-toggle="modal" data-target="#editEmployeeModal" onclick="GetDataByID(parseInt('{{id}}'))">
                                                    update
                                                </a> -->
                                                <a href="javascript:void(0);" onclick="openOffcanvas()">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 8 8"><path fill="currentColor" d="M5.88.03a1.9 1.9 0 0 0-.53.09c-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22c.35-.12.78-.07 1.06.22c.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47c-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5A1.98 1.98 0 0 0 6.44.07C6.26.03 6.06.03 5.88.04zm-2 2.31c-.5-.02-1.19.15-1.78.75L.6 4.59a1.98 1.98 0 0 0 0 2.81c.56.56 1.36.72 2.06.47c.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22c-.35.12-.78.07-1.06-.22c-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44c.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"/></svg>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {{/orders}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="finished-button">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-striped" id="orderFinishTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Total Order</th>
                                        <th>Price</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Ryzen 5 5000X</td>
                                        <td>3</td>
                                        <td>3.900.000</td>
                                        <td><h6 class="badge badge-info">On Delivery</h6></td>
                                        <td class="text-center">
                                            <div class="dropdown">
                                                <!-- editEmployeeModal -->
                                                <!-- <a href="javascript:void(0);" data-toggle="modal" data-target="#editEmployeeModal" onclick="GetDataByID(parseInt('{{id}}'))">
                                                    update
                                                </a> -->
                                                <a href="javascript:void(0);" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20"><g fill="currentColor"><circle cx="10" cy="15" r="2"/><circle cx="10" cy="10" r="2"/><circle cx="10" cy="5" r="2"/></g></svg>
                                                </a>
                                        
                                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                                    <a class="dropdown-item" href="javascript:void(0);">Update</a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item" href="javascript:void(0);" data-bs-toggle="offcanvas" data-bs-target="#staticBackdrop" aria-controls="staticBackdrop">Detail</a>
                                                    <!-- Tambahkan opsi dropdown lainnya sesuai kebutuhan -->
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card shadow mb-4" id="card-add-stocks" hidden>
        <div class="card">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Add Stock</h6>
            </div>
            <div class="card-body">
                <div class="form-wrap">	
                    <form id="survey-form">
                        <div class="row">
                            <div class="col-md-12">
                            <div id="existing-product">
                                    <div class="form-group">
                                        <label id="product-label" for="product_name">Product Name</label>
                                        <select class="form-control scrollable-menu" id="product-name" name="productName" onfocus="this.size=1;" onchange='this.size=1;'>
                                            <option value="" selected disabled>Select Product</option>
                                            {{#products}}
                                                <option value="{{id}}" data-price="{{price}}">{{name}} | stocks: {{stocks}}</option>
                                            {{/products}}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label id="buyer-label" for="buyer">Buyer</label>
                                    <input type="pengirim" name="buyer" id="buyer-form" class="form-control" placeholder="Ex: Anto"/>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label id="pieces_label" for="Pieces">Order Quantity</label>
                                    <input type="number" name="Pieces" id="pieces-form" placeholder="EX: 100" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label id="pengirim-label" for="stock">Number Phone</label>
                                    <input type="stock" name="stock" id="number-phone-buyer" class="form-control" placeholder="Ex: 1024"/>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label id="address_label" for="pengirim">Address</label>
                                    <input type="pengirim" name="address" id="address-buyer" class="form-control" placeholder="Ex: 2.240.000 (IDR)"/>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <button id="submit-order" class="btn btn-primary" type="button">
                                    <span id="loading-order" class="spinner-border-sm" role="status" style="margin-bottom: 10%;">Order</span>
                                </button>
                            </div>
                        </div>

                    </form>
                </div>	
            </div>
        </div>
        
    </div>
</div>
<!-- Modal Order -->
<div class="modal fade" id="confirm-order-modal" tabindex="-1" role="dialog" aria-labelledby="confirm-order-modalLabel" aria-hidden="true">
    <div class="modal-dialog" style="max-width: 50%; top: 70px" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title placeholder col-6" id="confirm-order-modalLabel">Order Detail</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="id-employee-edit">
            <h6>Product : <span id="order-product-name"></span></h6>
            <h6>Price  : <span id="order-product-price"></span></h6>
            <h5>Total <span id="total-order"></span></h5>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" id="confirm-order" class="btn btn-primary">Confirm</button>
        </div>
      </div>
    </div>
</div>
<script>
    const productName = document.getElementById("product-name");
    const buyerForm = document.getElementById("buyer-form");
    const piecesForm = document.getElementById("pieces-form");
    const numberPhoneBuyer = document.getElementById("number-phone-buyer")
    const addressBuyer = document.getElementById("address-buyer");
    
    const orderProductName = document.getElementById("order-product-name");
    const orderProductPrice = document.getElementById("order-product-price");
    const totalOrder = document.getElementById("total-order");

    const orderLoading = document.getElementById("loading-order");
    const submitOrder = document.getElementById("submit-order");

    submitOrder.addEventListener("click", (e) => {
        e.preventDefault();
        const isFormEmpty = buyerForm.value === "" || piecesForm.value === "" || numberPhoneBuyer.value === "" || addressBuyer.value === ""
        if (isFormEmpty) {
            ErrorNotif("Form is Empty!");
            return 0;
        }
        orderLoading.innerText = "";
        orderLoading.classList.add("spinner-border");

        const data = {
            idProduct: productName.value,
            quantity: piecesForm.value
        }

        fetch("/order/calculate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(results => {
            console.log(results);
            if (results.status != 200) {
                ErrorNotif(results.error);
                orderLoading.innerText = "Order";
                orderLoading.classList.remove("spinner-border");
                return 0;
            }
            else {
                orderLoading.innerText = "Order";
                orderLoading.classList.remove("spinner-border");

                $('#confirm-order-modal').modal('show');
                orderProductName.innerText = results.data.name; 
                orderProductPrice.innerText = results.data.price;
                totalOrder.innerText = `${piecesForm.value} x ${results.data.price} = ${results.data.payment}`;
            }
        })
        .catch(error => {
            console.error(error);
            orderLoading.innerText = "Order";
            orderLoading.classList.remove("spinner-border");
        })
    })
</script>
<script>
    // Confirm Order
    const confirmOrder = document.getElementById("confirm-order");

    confirmOrder.addEventListener("click", () => {
        confirmOrder.setAttribute("disabled", true)
        const data = {
            idProduct: productName.value,
            quantity: piecesForm.value,
            buyer: buyerForm.value,
            numberPhone: numberPhoneBuyer.value,
            address: addressBuyer.value
        }
        fetch("/order/new", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(results => {
            console.log(results);
            confirmOrder.removeAttribute("disabled");
            if (results.status !== 200) {
                Swal.fire({
                    icon: "error",
                    title: results.error,
                })
                return 0;
            }
            Swal.fire({
                icon: "success",
                title: "Success",
                text: results.message,
            })
            .then((result2) => {
                // Mereload halaman setelah tombol OK diklik
                if (result2.isConfirmed || result2.isDismissed) {
                    window.location.reload();
                }
                return 0;
            });
        })
        .catch(error => {
            console.error(error);
            confirmOrder.removeAttribute("disabled");
        })
    })
</script>
<script>
    $(document).ready(function() {
        $('#orderFinishTable').DataTable();
    });
    $(document).ready(function() {
        $('#orderGoingTable').DataTable();
    });
</script>
<script>
    const cardProducts = document.getElementById("card-products");
    const cardAddStocks = document.getElementById("card-add-stocks");
    const addStocksButton = document.getElementById("add-stocks-button")
    // const inventoryButton = document.getElementById("inventory-button");
    const returnButton = document.getElementById("return-button")

    addStocksButton.addEventListener("click", () => {
        cardAddStocks.removeAttribute("hidden");
        returnButton.removeAttribute("hidden");
        addStocksButton.setAttribute("hidden", true);
        cardProducts.setAttribute("hidden",true)
    });
    returnButton.addEventListener("click", () => {
        cardAddStocks.setAttribute("hidden", true);
        returnButton.setAttribute("hidden", true);
        addStocksButton.removeAttribute("hidden");
        cardProducts.removeAttribute("hidden");
    });
</script>